import argparse
import ctypes
import os
import string
import struct


def get_filename_hash(filename):
    hash = 0

    for cidx, c in enumerate(filename):
        for i in range(6):
            hash = ctypes.c_int(((hash >> 31) & 0x4c11db7) ^ ((hash << 1) | ((ord(c) >> i) & 1))).value

    return hash & 0xffffffff


def decompress_gcz(data):
    data_length = len(data)
    offset = 0
    output = []

    while offset < data_length:
        flag = data[offset]
        offset += 1

        for bit in range(8):
            if flag & (1 << bit):
                output.append(data[offset])
                offset += 1

            else:
                if offset + 2 > data_length:
                    break

                cmd1, cmd2 = data[offset:offset+2]
                lookback_length = (cmd1 & 0x0f) + 3
                lookback_offset = ((cmd1 & 0xf0) << 4) + cmd2
                offset += 2

                if cmd1 == 0 and cmd2 == 0:
                    break

                for _ in range(lookback_length):
                    loffset = len(output) - lookback_offset
                    if loffset <= 0 or loffset >= len(output):
                        output.append(0)

                    else:
                        output.append(output[loffset])

    return bytearray(output)


if __name__ == "__main__":
    parser = argparse.ArgumentParser()

    parser.add_argument('-i', '--input', help='Input file', default=None, required=True)
    parser.add_argument('-o', '--output', help='Output folder', default=None)

    args = parser.parse_args()

    found_filenames = [
        "copydisk/prog.zin",
        "fpga/prog.zin",
        "game/prog.zin",
        "gl/prog.zin",
        "grphinit/prog.zin",
        "hdimage/model/hikari.gtx",
        "hdimage/model/hikari.mbd",
        "hdimage/model/kango.mbd",
        "hdimage/model/kango1.gtx",
        "hdimage/model/kango2.gtx",
        "hdimage/model/kango2.mbd",
        "hdimage/model/kimo.gtx",
        "hdimage/model/kimo.mbd",
        "hdimage/model/kimo2.gtx",
        "hdimage/model/kimo2.mbd",
        "hdimage/model/money.mbd",
        "hdimage/model/money2.mbd",
        "hdimage/model/pants.gtx",
        "hdimage/model/pants.mbd",
        "hdimage/model/pants2.gtx",
        "hdimage/model/pants2.mbd",
        "hdimage/model/prim.gtx",
        "hdimage/model/prim.mbd",
        "hdimage/model/usao.gtx",
        "hdimage/model/usao.mbd",
        "hdimage/model/yoko.mbd",
        "hdimage/model/yoko1.gtx",
        "hdimage/model/yoko2.gtx",
        "hdimage/model/yoko2.mbd",
        "hdimage/motion/01speedw.hgm",
        "hdimage/motion/01speedw.hhd",
        "hdimage/motion/02eurobe.hgm",
        "hdimage/motion/02eurobe.hhd",
        "hdimage/motion/03nghtof.hgm",
        "hdimage/motion/03nghtof.hhd",
        "hdimage/motion/04tryme.hgm",
        "hdimage/motion/04tryme.hhd",
        "hdimage/motion/05yestdy.hgm",
        "hdimage/motion/05yestdy.hhd",
        "hdimage/motion/06likvgn.hgm",
        "hdimage/motion/06likvgn.hhd",
        "hdimage/motion/07tora.hgm",
        "hdimage/motion/07tora.hhd",
        "hdimage/motion/08arabia.hgm",
        "hdimage/motion/08arabia.hhd",
        "hdimage/motion/09boom2f.hgm",
        "hdimage/motion/09boom2f.hhd",
        "hdimage/motion/10mickey.hgm",
        "hdimage/motion/10mickey.hhd",
        "hdimage/motion/11crzy4u.hgm",
        "hdimage/motion/11crzy4u.hhd",
        "hdimage/motion/12remmbr.hgm",
        "hdimage/motion/12remmbr.hhd",
        "hdimage/motion/13stay.hgm",
        "hdimage/motion/13stay.hhd",
        "hdimage/motion/14romeo.hgm",
        "hdimage/motion/14romeo.hhd",
        "hdimage/motion/15burnin.hgm",
        "hdimage/motion/15burnin.hhd",
        "hdimage/motion/16kingdm.hgm",
        "hdimage/motion/16kingdm.hhd",
        "hdimage/motion/17godzil.hgm",
        "hdimage/motion/17godzil.hhd",
        "hdimage/motion/18holdon.hgm",
        "hdimage/motion/18holdon.hhd",
        "hdimage/motion/19lvagan.hgm",
        "hdimage/motion/19lvagan.hhd",
        "hdimage/motion/20iwdanc.hgm",
        "hdimage/motion/20iwdanc.hhd",
        "hdimage/motion/21anvs.hgm",
        "hdimage/motion/21anvs.hhd",
        "hdimage/motion/22engylv.hgm",
        "hdimage/motion/22engylv.hhd",
        "hdimage/motion/23luv2_y.hgm",
        "hdimage/motion/23luv2_y.hhd",
        "hdimage/motion/26cant_y.hgm",
        "hdimage/motion/26cant_y.hhd",
        "hdimage/motion/27dyna_y.hgm",
        "hdimage/motion/27dyna_y.hhd",
        "hdimage/motion/30jlousy.hgm",
        "hdimage/motion/30jlousy.hhd",
        "hdimage/motion/32aisiat.hgm",
        "hdimage/motion/32aisiat.hhd",
        "hdimage/motion/33dx_eur.hgm",
        "hdimage/motion/33dx_eur.hhd",
        "hdimage/motion/34ale.hgm",
        "hdimage/motion/34ale.hhd",
        "hdimage/motion/35banana.hgm",
        "hdimage/motion/35banana.hhd",
        "hdimage/motion/36madeof.hgm",
        "hdimage/motion/36madeof.hhd",
        "hdimage/motion/37myfire.hgm",
        "hdimage/motion/37myfire.hhd",
        "hdimage/motion/38bndler.hgm",
        "hdimage/motion/38bndler.hhd",
        "hdimage/motion/39plywit.hgm",
        "hdimage/motion/39plywit.hhd",
        "hdimage/motion/40soclos.hgm",
        "hdimage/motion/40soclos.hhd",
        "hdimage/motion/41slmio.hgm",
        "hdimage/motion/41slmio.hhd",
        "hdimage/motion/42hyaku.hgm",
        "hdimage/motion/42hyaku.hhd",
        "hdimage/motion/43money.hgm",
        "hdimage/motion/43money.hhd",
        "hdimage/motion/44vl2000.hgm",
        "hdimage/motion/44vl2000.hhd",
        "hdimage/motion/45dancer.hgm",
        "hdimage/motion/45dancer.hhd",
        "hdimage/motion/46feelin.hgm",
        "hdimage/motion/46feelin.hhd",
        "hdimage/motion/47we2are.hgm",
        "hdimage/motion/47we2are.hhd",
        "hdimage/motion/48kiskis.hgm",
        "hdimage/motion/48kiskis.hhd",
        "hdimage/motion/49statin.hgm",
        "hdimage/motion/49statin.hhd",
        "hdimage/motion/50jam.hgm",
        "hdimage/motion/50jam.hhd",
        "hdimage/motion/51number.hgm",
        "hdimage/motion/51number.hhd",
        "hdimage/motion/52dltcom.hgm",
        "hdimage/motion/52dltcom.hhd",
        "hdimage/motion/53blieve.hgm",
        "hdimage/motion/53blieve.hhd",
        "hdimage/motion/56popten.hgm",
        "hdimage/motion/56popten.hhd",
        "hdimage/motion/57takeme.hgm",
        "hdimage/motion/57takeme.hhd",
        "hdimage/motion/58esybsy.hgm",
        "hdimage/motion/58esybsy.hhd",
        "hdimage/motion/59sexy.hgm",
        "hdimage/motion/59sexy.hhd",
        "hdimage/motion/63mikado.hgm",
        "hdimage/motion/63mikado.hhd",
        "hdimage/motion/64dejavu.hgm",
        "hdimage/motion/64dejavu.hhd",
        "hdimage/motion/65hiheel.hgm",
        "hdimage/motion/65hiheel.hhd",
        "hdimage/motion/66broken.hgm",
        "hdimage/motion/66broken.hhd",
        "hdimage/picture/bg/aisiat/0.gcz",
        "hdimage/picture/bg/aisiat/1.gcz",
        "hdimage/picture/bg/aisiat/index.idx",
        "hdimage/picture/bg/ale/0.gcz",
        "hdimage/picture/bg/ale/1.gcz",
        "hdimage/picture/bg/ale/index.idx",
        "hdimage/picture/bg/anvs/0.gcz",
        "hdimage/picture/bg/anvs/1.gcz",
        "hdimage/picture/bg/anvs/index.idx",
        "hdimage/picture/bg/arabia/0.gcz",
        "hdimage/picture/bg/arabia/1.gcz",
        "hdimage/picture/bg/arabia/index.idx",
        "hdimage/picture/bg/banana/0.gcz",
        "hdimage/picture/bg/banana/1.gcz",
        "hdimage/picture/bg/banana/index.idx",
        "hdimage/picture/bg/blieve/0.gcz",
        "hdimage/picture/bg/blieve/1.gcz",
        "hdimage/picture/bg/blieve/index.idx",
        "hdimage/picture/bg/bndler/0.gcz",
        "hdimage/picture/bg/bndler/1.gcz",
        "hdimage/picture/bg/bndler/index.idx",
        "hdimage/picture/bg/boom2f/0.gcz",
        "hdimage/picture/bg/boom2f/1.gcz",
        "hdimage/picture/bg/boom2f/index.idx",
        "hdimage/picture/bg/brok_y/0.gcz",
        "hdimage/picture/bg/brok_y/1.gcz",
        "hdimage/picture/bg/brok_y/index.idx",
        "hdimage/picture/bg/burnin/0.gcz",
        "hdimage/picture/bg/burnin/1.gcz",
        "hdimage/picture/bg/burnin/index.idx",
        "hdimage/picture/bg/cant_y/0.gcz",
        "hdimage/picture/bg/cant_y/1.gcz",
        "hdimage/picture/bg/cant_y/index.idx",
        "hdimage/picture/bg/crzy4u/0.gcz",
        "hdimage/picture/bg/crzy4u/1.gcz",
        "hdimage/picture/bg/crzy4u/index.idx",
        "hdimage/picture/bg/dancer/0.gcz",
        "hdimage/picture/bg/dancer/1.gcz",
        "hdimage/picture/bg/dancer/index.idx",
        "hdimage/picture/bg/dejavu/0.gcz",
        "hdimage/picture/bg/dejavu/1.gcz",
        "hdimage/picture/bg/dejavu/index.idx",
        "hdimage/picture/bg/dltcom/0.gcz",
        "hdimage/picture/bg/dltcom/1.gcz",
        "hdimage/picture/bg/dltcom/index.idx",
        "hdimage/picture/bg/dx_eur/0.gcz",
        "hdimage/picture/bg/dx_eur/1.gcz",
        "hdimage/picture/bg/dx_eur/index.idx",
        "hdimage/picture/bg/dyna_y/0.gcz",
        "hdimage/picture/bg/dyna_y/1.gcz",
        "hdimage/picture/bg/dyna_y/index.idx",
        "hdimage/picture/bg/enegy/0.gcz",
        "hdimage/picture/bg/enegy/1.gcz",
        "hdimage/picture/bg/enegy/index.idx",
        "hdimage/picture/bg/esybsy/0.gcz",
        "hdimage/picture/bg/esybsy/1.gcz",
        "hdimage/picture/bg/esybsy/index.idx",
        "hdimage/picture/bg/eurobe/0.gcz",
        "hdimage/picture/bg/eurobe/1.gcz",
        "hdimage/picture/bg/eurobe/index.idx",
        "hdimage/picture/bg/feelin/0.gcz",
        "hdimage/picture/bg/feelin/1.gcz",
        "hdimage/picture/bg/feelin/index.idx",
        "hdimage/picture/bg/godzil/0.gcz",
        "hdimage/picture/bg/godzil/1.gcz",
        "hdimage/picture/bg/godzil/index.idx",
        "hdimage/picture/bg/holdon/0.gcz",
        "hdimage/picture/bg/holdon/1.gcz",
        "hdimage/picture/bg/holdon/index.idx",
        "hdimage/picture/bg/howto/0.gcz",
        "hdimage/picture/bg/howto/index.idx",
        "hdimage/picture/bg/hyaku/0.gcz",
        "hdimage/picture/bg/hyaku/1.gcz",
        "hdimage/picture/bg/hyaku/index.idx",
        "hdimage/picture/bg/iwana/0.gcz",
        "hdimage/picture/bg/iwana/1.gcz",
        "hdimage/picture/bg/iwana/index.idx",
        "hdimage/picture/bg/jam/0.gcz",
        "hdimage/picture/bg/jam/1.gcz",
        "hdimage/picture/bg/jam/index.idx",
        "hdimage/picture/bg/jlousy/0.gcz",
        "hdimage/picture/bg/jlousy/1.gcz",
        "hdimage/picture/bg/jlousy/index.idx",
        "hdimage/picture/bg/kingdm/0.gcz",
        "hdimage/picture/bg/kingdm/1.gcz",
        "hdimage/picture/bg/kingdm/index.idx",
        "hdimage/picture/bg/kiss3/0.gcz",
        "hdimage/picture/bg/kiss3/1.gcz",
        "hdimage/picture/bg/kiss3/index.idx",
        "hdimage/picture/bg/likvgn/0.gcz",
        "hdimage/picture/bg/likvgn/1.gcz",
        "hdimage/picture/bg/likvgn/index.idx",
        "hdimage/picture/bg/luv2_y/0.gcz",
        "hdimage/picture/bg/luv2_y/1.gcz",
        "hdimage/picture/bg/luv2_y/index.idx",
        "hdimage/picture/bg/lvag/0.gcz",
        "hdimage/picture/bg/lvag/1.gcz",
        "hdimage/picture/bg/lvag/index.idx",
        "hdimage/picture/bg/madeof/0.gcz",
        "hdimage/picture/bg/madeof/1.gcz",
        "hdimage/picture/bg/madeof/index.idx",
        "hdimage/picture/bg/mickey/0.gcz",
        "hdimage/picture/bg/mickey/1.gcz",
        "hdimage/picture/bg/mickey/index.idx",
        "hdimage/picture/bg/mikado/0.gcz",
        "hdimage/picture/bg/mikado/1.gcz",
        "hdimage/picture/bg/mikado/index.idx",
        "hdimage/picture/bg/money/0.gcz",
        "hdimage/picture/bg/money/1.gcz",
        "hdimage/picture/bg/money/index.idx",
        "hdimage/picture/bg/myfire/0.gcz",
        "hdimage/picture/bg/myfire/1.gcz",
        "hdimage/picture/bg/myfire/index.idx",
        "hdimage/picture/bg/nghtof/0.gcz",
        "hdimage/picture/bg/nghtof/1.gcz",
        "hdimage/picture/bg/nghtof/index.idx",
        "hdimage/picture/bg/number/0.gcz",
        "hdimage/picture/bg/number/1.gcz",
        "hdimage/picture/bg/number/index.idx",
        "hdimage/picture/bg/plywit/0.gcz",
        "hdimage/picture/bg/plywit/index.idx",
        "hdimage/picture/bg/popten/0.gcz",
        "hdimage/picture/bg/popten/1.gcz",
        "hdimage/picture/bg/popten/index.idx",
        "hdimage/picture/bg/remmbr/0.gcz",
        "hdimage/picture/bg/remmbr/1.gcz",
        "hdimage/picture/bg/remmbr/index.idx",
        "hdimage/picture/bg/romeo/0.gcz",
        "hdimage/picture/bg/romeo/1.gcz",
        "hdimage/picture/bg/romeo/index.idx",
        "hdimage/picture/bg/sexy3/0.gcz",
        "hdimage/picture/bg/sexy3/1.gcz",
        "hdimage/picture/bg/sexy3/index.idx",
        "hdimage/picture/bg/slmio/0.gcz",
        "hdimage/picture/bg/slmio/1.gcz",
        "hdimage/picture/bg/slmio/index.idx",
        "hdimage/picture/bg/soclos/0.gcz",
        "hdimage/picture/bg/soclos/1.gcz",
        "hdimage/picture/bg/soclos/index.idx",
        "hdimage/picture/bg/spd1/0.gcz",
        "hdimage/picture/bg/spd1/1.gcz",
        "hdimage/picture/bg/spd1/index.idx",
        "hdimage/picture/bg/speedw/0.gcz",
        "hdimage/picture/bg/speedw/1.gcz",
        "hdimage/picture/bg/speedw/index.idx",
        "hdimage/picture/bg/statin/0.gcz",
        "hdimage/picture/bg/statin/1.gcz",
        "hdimage/picture/bg/statin/index.idx",
        "hdimage/picture/bg/stay/0.gcz",
        "hdimage/picture/bg/stay/1.gcz",
        "hdimage/picture/bg/stay/index.idx",
        "hdimage/picture/bg/takeme/0.gcz",
        "hdimage/picture/bg/takeme/1.gcz",
        "hdimage/picture/bg/takeme/index.idx",
        "hdimage/picture/bg/tora/0.gcz",
        "hdimage/picture/bg/tora/1.gcz",
        "hdimage/picture/bg/tora/index.idx",
        "hdimage/picture/bg/tryme/0.gcz",
        "hdimage/picture/bg/tryme/1.gcz",
        "hdimage/picture/bg/tryme/index.idx",
        "hdimage/picture/bg/ultr_y/0.gcz",
        "hdimage/picture/bg/ultr_y/1.gcz",
        "hdimage/picture/bg/ultr_y/index.idx",
        "hdimage/picture/bg/vl2000/0.gcz",
        "hdimage/picture/bg/vl2000/1.gcz",
        "hdimage/picture/bg/vl2000/index.idx",
        "hdimage/picture/bg/wetwo/0.gcz",
        "hdimage/picture/bg/wetwo/1.gcz",
        "hdimage/picture/bg/wetwo/index.idx",
        "hdimage/picture/bg/yestdy/0.gcz",
        "hdimage/picture/bg/yestdy/1.gcz",
        "hdimage/picture/bg/yestdy/index.idx",
        "hdimage/picture/bg_prk/01speedw/0.gcz",
        "hdimage/picture/bg_prk/01speedw/index.idx",
        "hdimage/picture/bg_prk/02eurobe/0.gcz",
        "hdimage/picture/bg_prk/02eurobe/index.idx",
        "hdimage/picture/bg_prk/03nghtof/0.gcz",
        "hdimage/picture/bg_prk/03nghtof/index.idx",
        "hdimage/picture/bg_prk/04tryme/0.gcz",
        "hdimage/picture/bg_prk/04tryme/index.idx",
        "hdimage/picture/bg_prk/05yestdy/0.gcz",
        "hdimage/picture/bg_prk/05yestdy/index.idx",
        "hdimage/picture/bg_prk/06likvgn/0.gcz",
        "hdimage/picture/bg_prk/06likvgn/index.idx",
        "hdimage/picture/bg_prk/07tora/0.gcz",
        "hdimage/picture/bg_prk/07tora/index.idx",
        "hdimage/picture/bg_prk/08arabia/0.gcz",
        "hdimage/picture/bg_prk/08arabia/index.idx",
        "hdimage/picture/bg_prk/09boom2f/0.gcz",
        "hdimage/picture/bg_prk/09boom2f/index.idx",
        "hdimage/picture/bg_prk/10mickey/0.gcz",
        "hdimage/picture/bg_prk/10mickey/index.idx",
        "hdimage/picture/bg_prk/11crzy4u/0.gcz",
        "hdimage/picture/bg_prk/11crzy4u/index.idx",
        "hdimage/picture/bg_prk/12remmbr/0.gcz",
        "hdimage/picture/bg_prk/12remmbr/index.idx",
        "hdimage/picture/bg_prk/13stay/0.gcz",
        "hdimage/picture/bg_prk/13stay/index.idx",
        "hdimage/picture/bg_prk/14romeo/0.gcz",
        "hdimage/picture/bg_prk/14romeo/index.idx",
        "hdimage/picture/bg_prk/15burnin/0.gcz",
        "hdimage/picture/bg_prk/15burnin/index.idx",
        "hdimage/picture/bg_prk/16kingdm/0.gcz",
        "hdimage/picture/bg_prk/16kingdm/index.idx",
        "hdimage/picture/bg_prk/17godzil/0.gcz",
        "hdimage/picture/bg_prk/17godzil/index.idx",
        "hdimage/picture/bg_prk/18holdon/0.gcz",
        "hdimage/picture/bg_prk/18holdon/index.idx",
        "hdimage/picture/bg_prk/19lvagan/0.gcz",
        "hdimage/picture/bg_prk/19lvagan/index.idx",
        "hdimage/picture/bg_prk/20iwdanc/0.gcz",
        "hdimage/picture/bg_prk/20iwdanc/index.idx",
        "hdimage/picture/bg_prk/21anvs/0.gcz",
        "hdimage/picture/bg_prk/21anvs/index.idx",
        "hdimage/picture/bg_prk/22engylv/0.gcz",
        "hdimage/picture/bg_prk/22engylv/index.idx",
        "hdimage/picture/bg_prk/23luv2_y/0.gcz",
        "hdimage/picture/bg_prk/23luv2_y/index.idx",
        "hdimage/picture/bg_prk/26cant_y/0.gcz",
        "hdimage/picture/bg_prk/26cant_y/index.idx",
        "hdimage/picture/bg_prk/27dyna_y/0.gcz",
        "hdimage/picture/bg_prk/27dyna_y/index.idx",
        "hdimage/picture/bg_prk/30jlousy/0.gcz",
        "hdimage/picture/bg_prk/30jlousy/index.idx",
        "hdimage/picture/bg_prk/32aisiat/0.gcz",
        "hdimage/picture/bg_prk/32aisiat/index.idx",
        "hdimage/picture/bg_prk/33dx_eur/0.gcz",
        "hdimage/picture/bg_prk/33dx_eur/index.idx",
        "hdimage/picture/bg_prk/34ale/0.gcz",
        "hdimage/picture/bg_prk/34ale/index.idx",
        "hdimage/picture/bg_prk/35banana/0.gcz",
        "hdimage/picture/bg_prk/35banana/index.idx",
        "hdimage/picture/bg_prk/36madeof/0.gcz",
        "hdimage/picture/bg_prk/36madeof/index.idx",
        "hdimage/picture/bg_prk/37myfire/0.gcz",
        "hdimage/picture/bg_prk/37myfire/index.idx",
        "hdimage/picture/bg_prk/38bndler/0.gcz",
        "hdimage/picture/bg_prk/38bndler/index.idx",
        "hdimage/picture/bg_prk/39plywit/0.gcz",
        "hdimage/picture/bg_prk/39plywit/index.idx",
        "hdimage/picture/bg_prk/40soclos/0.gcz",
        "hdimage/picture/bg_prk/40soclos/index.idx",
        "hdimage/picture/bg_prk/41slmio/0.gcz",
        "hdimage/picture/bg_prk/41slmio/index.idx",
        "hdimage/picture/bg_prk/42hyaku/0.gcz",
        "hdimage/picture/bg_prk/42hyaku/index.idx",
        "hdimage/picture/bg_prk/43money/0.gcz",
        "hdimage/picture/bg_prk/43money/index.idx",
        "hdimage/picture/bg_prk/44vl2000/0.gcz",
        "hdimage/picture/bg_prk/44vl2000/index.idx",
        "hdimage/picture/bg_prk/45dancer/0.gcz",
        "hdimage/picture/bg_prk/45dancer/index.idx",
        "hdimage/picture/bg_prk/46feelin/0.gcz",
        "hdimage/picture/bg_prk/46feelin/index.idx",
        "hdimage/picture/bg_prk/47wetwo/0.gcz",
        "hdimage/picture/bg_prk/47wetwo/index.idx",
        "hdimage/picture/bg_prk/48kiss3/0.gcz",
        "hdimage/picture/bg_prk/48kiss3/index.idx",
        "hdimage/picture/bg_prk/49statio/0.gcz",
        "hdimage/picture/bg_prk/49statio/index.idx",
        "hdimage/picture/bg_prk/50jam/0.gcz",
        "hdimage/picture/bg_prk/50jam/index.idx",
        "hdimage/picture/bg_prk/51number/0.gcz",
        "hdimage/picture/bg_prk/51number/index.idx",
        "hdimage/picture/bg_prk/52dltcom/0.gcz",
        "hdimage/picture/bg_prk/52dltcom/index.idx",
        "hdimage/picture/bg_prk/53blieve/0.gcz",
        "hdimage/picture/bg_prk/53blieve/index.idx",
        "hdimage/picture/bg_prk/56popten/0.gcz",
        "hdimage/picture/bg_prk/56popten/index.idx",
        "hdimage/picture/bg_prk/57takeme/0.gcz",
        "hdimage/picture/bg_prk/57takeme/index.idx",
        "hdimage/picture/bg_prk/58esybsy/0.gcz",
        "hdimage/picture/bg_prk/58esybsy/index.idx",
        "hdimage/picture/bg_prk/59sexy3/0.gcz",
        "hdimage/picture/bg_prk/59sexy3/index.idx",
        "hdimage/picture/bg_prk/63mikado/0.gcz",
        "hdimage/picture/bg_prk/63mikado/index.idx",
        "hdimage/picture/bg_prk/64dejavu/0.gcz",
        "hdimage/picture/bg_prk/64dejavu/index.idx",
        "hdimage/picture/bg_prk/65ultr_y/0.gcz",
        "hdimage/picture/bg_prk/65ultr_y/index.idx",
        "hdimage/picture/bg_prk/66brok_y/0.gcz",
        "hdimage/picture/bg_prk/66brok_y/index.idx",
        "hdimage/picture/sys/cleared/0.gcz",
        "hdimage/picture/sys/company1/0.gcz",
        "hdimage/picture/sys/company1/system.idx",
        "hdimage/picture/sys/company2/0.gcz",
        "hdimage/picture/sys/company2/system.idx",
        "hdimage/picture/sys/edparako/0.gcz",
        "hdimage/picture/sys/edparako/system.idx",
        "hdimage/picture/sys/ed_free/0.gcz",
        "hdimage/picture/sys/ed_free/1.gcz",
        "hdimage/picture/sys/ed_free/system.idx",
        "hdimage/picture/sys/ed_para/0.gcz",
        "hdimage/picture/sys/ed_para/1.gcz",
        "hdimage/picture/sys/ed_para/system.idx",
        "hdimage/picture/sys/failed/0.gcz",
        "hdimage/picture/sys/frame_n/0.gcz",
        "hdimage/picture/sys/frame_p/0.gcz",
        "hdimage/picture/sys/frame_p/1.gcz",
        "hdimage/picture/sys/gameover/0.gcz",
        "hdimage/picture/sys/gameover/system.idx",
        "hdimage/picture/sys/in_rank/0.gcz",
        "hdimage/picture/sys/in_rank/system.idx",
        "hdimage/picture/sys/keikoku/0.gcz",
        "hdimage/picture/sys/keikoku/system.idx",
        "hdimage/picture/sys/keikok_e/0.gcz",
        "hdimage/picture/sys/keikok_e/system.idx",
        "hdimage/picture/sys/linkwait/0.gcz",
        "hdimage/picture/sys/name/0.gcz",
        "hdimage/picture/sys/name/system.idx",
        "hdimage/picture/sys/ned_free/0.gcz",
        "hdimage/picture/sys/ned_free/system.idx",
        "hdimage/picture/sys/ned_para/0.gcz",
        "hdimage/picture/sys/ned_para/system.idx",
        "hdimage/picture/sys/ranking/0.gcz",
        "hdimage/picture/sys/ranking/system.idx",
        "hdimage/picture/sys/select/0.gcz",
        "hdimage/picture/sys/select/1.gcz",
        "hdimage/picture/sys/select/system.idx",
        "hdimage/picture/sys/system/0.gcz",
        "hdimage/picture/sys/testmode/0.gcz",
        "hdimage/picture/sys/title/0.gcz",
        "hdimage/picture/sys/t_result/0.gcz",
        "hdimage/picture/sys/t_result/system.idx",
        "hdimage/sound/adpcm/01speedw.adp",
        "hdimage/sound/adpcm/02eurobe.adp",
        "hdimage/sound/adpcm/03nghtof.adp",
        "hdimage/sound/adpcm/04tryme.adp",
        "hdimage/sound/adpcm/05yestdy.adp",
        "hdimage/sound/adpcm/06likvgn.adp",
        "hdimage/sound/adpcm/07tora.adp",
        "hdimage/sound/adpcm/08arabia.adp",
        "hdimage/sound/adpcm/09boom2f.adp",
        "hdimage/sound/adpcm/10mickey.adp",
        "hdimage/sound/adpcm/11crzy4u.adp",
        "hdimage/sound/adpcm/12remmbr.adp",
        "hdimage/sound/adpcm/13stay.adp",
        "hdimage/sound/adpcm/14romeo.adp",
        "hdimage/sound/adpcm/15burnin.adp",
        "hdimage/sound/adpcm/16kingdm.adp",
        "hdimage/sound/adpcm/17godzil.adp",
        "hdimage/sound/adpcm/18holdon.adp",
        "hdimage/sound/adpcm/19lvagan.adp",
        "hdimage/sound/adpcm/20iwdanc.adp",
        "hdimage/sound/adpcm/21anvs.adp",
        "hdimage/sound/adpcm/22engylv.adp",
        "hdimage/sound/adpcm/23luv2_y.adp",
        "hdimage/sound/adpcm/24sysstr.adp",
        "hdimage/sound/adpcm/25systek.adp",
        "hdimage/sound/adpcm/26cant_y.adp",
        "hdimage/sound/adpcm/27dyna_y.adp",
        "hdimage/sound/adpcm/28sysnam.adp",
        "hdimage/sound/adpcm/29sysstr.adp",
        "hdimage/sound/adpcm/30jlousy.adp",
        "hdimage/sound/adpcm/31sysetc.adp",
        "hdimage/sound/adpcm/32aisiat.adp",
        "hdimage/sound/adpcm/33dx_eur.adp",
        "hdimage/sound/adpcm/34ale.adp",
        "hdimage/sound/adpcm/35banana.adp",
        "hdimage/sound/adpcm/36madeof.adp",
        "hdimage/sound/adpcm/37myfire.adp",
        "hdimage/sound/adpcm/38bndler.adp",
        "hdimage/sound/adpcm/39plywit.adp",
        "hdimage/sound/adpcm/40soclos.adp",
        "hdimage/sound/adpcm/41slmio.adp",
        "hdimage/sound/adpcm/42hyaku.adp",
        "hdimage/sound/adpcm/43mon_s.adp",
        "hdimage/sound/adpcm/44vl2000.adp",
        "hdimage/sound/adpcm/45dancer.adp",
        "hdimage/sound/adpcm/46feelin.adp",
        "hdimage/sound/adpcm/47wetwo.adp",
        "hdimage/sound/adpcm/48kiss3.adp",
        "hdimage/sound/adpcm/49statio.adp",
        "hdimage/sound/adpcm/50jam.adp",
        "hdimage/sound/adpcm/51number.adp",
        "hdimage/sound/adpcm/52dltcom.adp",
        "hdimage/sound/adpcm/53blieve.adp",
        "hdimage/sound/adpcm/54mikado.adp",
        "hdimage/sound/adpcm/55dejavu.adp",
        "hdimage/sound/adpcm/56popten.adp",
        "hdimage/sound/adpcm/57takeme.adp",
        "hdimage/sound/adpcm/58esybsy.adp",
        "hdimage/sound/adpcm/59sexy3.adp",
        "hdimage/sound/adpcm/60syslop.adp",
        "hdimage/sound/adpcm/65ultr_y.adp",
        "hdimage/sound/adpcm/66brok_y.adp",
        "hdimage/sound/adpcm/ending.adp",
        "hdimage/sound/playdata/01_1.bin",
        "hdimage/sound/playdata/01_a.bin",
        "hdimage/sound/playdata/01_b.bin",
        "hdimage/sound/playdata/01_c.bin",
        "hdimage/sound/playdata/02_1.bin",
        "hdimage/sound/playdata/02_a.bin",
        "hdimage/sound/playdata/02_b.bin",
        "hdimage/sound/playdata/02_c.bin",
        "hdimage/sound/playdata/03_1.bin",
        "hdimage/sound/playdata/03_a.bin",
        "hdimage/sound/playdata/03_b.bin",
        "hdimage/sound/playdata/03_c.bin",
        "hdimage/sound/playdata/04_1.bin",
        "hdimage/sound/playdata/04_a.bin",
        "hdimage/sound/playdata/04_b.bin",
        "hdimage/sound/playdata/04_c.bin",
        "hdimage/sound/playdata/05_1.bin",
        "hdimage/sound/playdata/05_a.bin",
        "hdimage/sound/playdata/05_b.bin",
        "hdimage/sound/playdata/05_c.bin",
        "hdimage/sound/playdata/06_1.bin",
        "hdimage/sound/playdata/06_a.bin",
        "hdimage/sound/playdata/06_b.bin",
        "hdimage/sound/playdata/06_c.bin",
        "hdimage/sound/playdata/07_1.bin",
        "hdimage/sound/playdata/07_a.bin",
        "hdimage/sound/playdata/07_b.bin",
        "hdimage/sound/playdata/07_c.bin",
        "hdimage/sound/playdata/08_1.bin",
        "hdimage/sound/playdata/08_a.bin",
        "hdimage/sound/playdata/08_b.bin",
        "hdimage/sound/playdata/08_c.bin",
        "hdimage/sound/playdata/09_1.bin",
        "hdimage/sound/playdata/09_a.bin",
        "hdimage/sound/playdata/09_b.bin",
        "hdimage/sound/playdata/09_c.bin",
        "hdimage/sound/playdata/10_1.bin",
        "hdimage/sound/playdata/10_a.bin",
        "hdimage/sound/playdata/10_b.bin",
        "hdimage/sound/playdata/10_c.bin",
        "hdimage/sound/playdata/11_1.bin",
        "hdimage/sound/playdata/11_a.bin",
        "hdimage/sound/playdata/11_b.bin",
        "hdimage/sound/playdata/11_c.bin",
        "hdimage/sound/playdata/12_1.bin",
        "hdimage/sound/playdata/12_a.bin",
        "hdimage/sound/playdata/12_b.bin",
        "hdimage/sound/playdata/12_c.bin",
        "hdimage/sound/playdata/13_1.bin",
        "hdimage/sound/playdata/13_a.bin",
        "hdimage/sound/playdata/13_b.bin",
        "hdimage/sound/playdata/13_c.bin",
        "hdimage/sound/playdata/14_1.bin",
        "hdimage/sound/playdata/14_a.bin",
        "hdimage/sound/playdata/14_b.bin",
        "hdimage/sound/playdata/14_c.bin",
        "hdimage/sound/playdata/15_1.bin",
        "hdimage/sound/playdata/15_a.bin",
        "hdimage/sound/playdata/15_b.bin",
        "hdimage/sound/playdata/15_c.bin",
        "hdimage/sound/playdata/16_1.bin",
        "hdimage/sound/playdata/16_a.bin",
        "hdimage/sound/playdata/16_b.bin",
        "hdimage/sound/playdata/16_c.bin",
        "hdimage/sound/playdata/17_1.bin",
        "hdimage/sound/playdata/17_a.bin",
        "hdimage/sound/playdata/17_b.bin",
        "hdimage/sound/playdata/17_c.bin",
        "hdimage/sound/playdata/18_1.bin",
        "hdimage/sound/playdata/18_a.bin",
        "hdimage/sound/playdata/18_b.bin",
        "hdimage/sound/playdata/18_c.bin",
        "hdimage/sound/playdata/19_1.bin",
        "hdimage/sound/playdata/19_a.bin",
        "hdimage/sound/playdata/19_b.bin",
        "hdimage/sound/playdata/19_c.bin",
        "hdimage/sound/playdata/20_1.bin",
        "hdimage/sound/playdata/20_a.bin",
        "hdimage/sound/playdata/20_b.bin",
        "hdimage/sound/playdata/20_c.bin",
        "hdimage/sound/playdata/21_1.bin",
        "hdimage/sound/playdata/21_a.bin",
        "hdimage/sound/playdata/21_b.bin",
        "hdimage/sound/playdata/21_c.bin",
        "hdimage/sound/playdata/22_1.bin",
        "hdimage/sound/playdata/22_a.bin",
        "hdimage/sound/playdata/22_b.bin",
        "hdimage/sound/playdata/22_c.bin",
        "hdimage/sound/playdata/23_1.bin",
        "hdimage/sound/playdata/23_a.bin",
        "hdimage/sound/playdata/23_b.bin",
        "hdimage/sound/playdata/23_c.bin",
        "hdimage/sound/playdata/26_1.bin",
        "hdimage/sound/playdata/26_a.bin",
        "hdimage/sound/playdata/26_b.bin",
        "hdimage/sound/playdata/26_c.bin",
        "hdimage/sound/playdata/27_1.bin",
        "hdimage/sound/playdata/27_a.bin",
        "hdimage/sound/playdata/27_b.bin",
        "hdimage/sound/playdata/27_c.bin",
        "hdimage/sound/playdata/30_1.bin",
        "hdimage/sound/playdata/30_a.bin",
        "hdimage/sound/playdata/30_b.bin",
        "hdimage/sound/playdata/30_c.bin",
        "hdimage/sound/playdata/32_1.bin",
        "hdimage/sound/playdata/32_a.bin",
        "hdimage/sound/playdata/32_b.bin",
        "hdimage/sound/playdata/32_c.bin",
        "hdimage/sound/playdata/33_1.bin",
        "hdimage/sound/playdata/33_a.bin",
        "hdimage/sound/playdata/33_b.bin",
        "hdimage/sound/playdata/33_c.bin",
        "hdimage/sound/playdata/34_1.bin",
        "hdimage/sound/playdata/34_a.bin",
        "hdimage/sound/playdata/34_b.bin",
        "hdimage/sound/playdata/34_c.bin",
        "hdimage/sound/playdata/35_1.bin",
        "hdimage/sound/playdata/35_a.bin",
        "hdimage/sound/playdata/35_b.bin",
        "hdimage/sound/playdata/35_c.bin",
        "hdimage/sound/playdata/36_1.bin",
        "hdimage/sound/playdata/36_a.bin",
        "hdimage/sound/playdata/36_b.bin",
        "hdimage/sound/playdata/36_c.bin",
        "hdimage/sound/playdata/37_1.bin",
        "hdimage/sound/playdata/37_a.bin",
        "hdimage/sound/playdata/37_b.bin",
        "hdimage/sound/playdata/37_c.bin",
        "hdimage/sound/playdata/38_1.bin",
        "hdimage/sound/playdata/38_a.bin",
        "hdimage/sound/playdata/38_b.bin",
        "hdimage/sound/playdata/38_c.bin",
        "hdimage/sound/playdata/39_1.bin",
        "hdimage/sound/playdata/39_a.bin",
        "hdimage/sound/playdata/39_b.bin",
        "hdimage/sound/playdata/39_c.bin",
        "hdimage/sound/playdata/40_1.bin",
        "hdimage/sound/playdata/40_a.bin",
        "hdimage/sound/playdata/40_b.bin",
        "hdimage/sound/playdata/40_c.bin",
        "hdimage/sound/playdata/41_1.bin",
        "hdimage/sound/playdata/41_a.bin",
        "hdimage/sound/playdata/41_b.bin",
        "hdimage/sound/playdata/41_c.bin",
        "hdimage/sound/playdata/42_1.bin",
        "hdimage/sound/playdata/42_a.bin",
        "hdimage/sound/playdata/42_b.bin",
        "hdimage/sound/playdata/42_c.bin",
        "hdimage/sound/playdata/43_1.bin",
        "hdimage/sound/playdata/43_a.bin",
        "hdimage/sound/playdata/43_b.bin",
        "hdimage/sound/playdata/43_c.bin",
        "hdimage/sound/playdata/44_1.bin",
        "hdimage/sound/playdata/44_a.bin",
        "hdimage/sound/playdata/44_b.bin",
        "hdimage/sound/playdata/44_c.bin",
        "hdimage/sound/playdata/45_1.bin",
        "hdimage/sound/playdata/45_a.bin",
        "hdimage/sound/playdata/45_b.bin",
        "hdimage/sound/playdata/45_c.bin",
        "hdimage/sound/playdata/46_1.bin",
        "hdimage/sound/playdata/46_a.bin",
        "hdimage/sound/playdata/46_b.bin",
        "hdimage/sound/playdata/46_c.bin",
        "hdimage/sound/playdata/47_1.bin",
        "hdimage/sound/playdata/47_a.bin",
        "hdimage/sound/playdata/47_b.bin",
        "hdimage/sound/playdata/47_c.bin",
        "hdimage/sound/playdata/48_1.bin",
        "hdimage/sound/playdata/48_a.bin",
        "hdimage/sound/playdata/48_b.bin",
        "hdimage/sound/playdata/48_c.bin",
        "hdimage/sound/playdata/49_1.bin",
        "hdimage/sound/playdata/49_a.bin",
        "hdimage/sound/playdata/49_b.bin",
        "hdimage/sound/playdata/49_c.bin",
        "hdimage/sound/playdata/50_1.bin",
        "hdimage/sound/playdata/50_a.bin",
        "hdimage/sound/playdata/50_c.bin",
        "hdimage/sound/playdata/51_1.bin",
        "hdimage/sound/playdata/51_a.bin",
        "hdimage/sound/playdata/51_c.bin",
        "hdimage/sound/playdata/52_1.bin",
        "hdimage/sound/playdata/52_a.bin",
        "hdimage/sound/playdata/52_c.bin",
        "hdimage/sound/playdata/53_1.bin",
        "hdimage/sound/playdata/53_a.bin",
        "hdimage/sound/playdata/53_c.bin",
        "hdimage/sound/playdata/56_1.bin",
        "hdimage/sound/playdata/56_a.bin",
        "hdimage/sound/playdata/56_c.bin",
        "hdimage/sound/playdata/57_1.bin",
        "hdimage/sound/playdata/57_a.bin",
        "hdimage/sound/playdata/57_c.bin",
        "hdimage/sound/playdata/58_1.bin",
        "hdimage/sound/playdata/58_a.bin",
        "hdimage/sound/playdata/58_c.bin",
        "hdimage/sound/playdata/59_1.bin",
        "hdimage/sound/playdata/59_a.bin",
        "hdimage/sound/playdata/59_c.bin",
        "hdimage/sound/playdata/63_1.bin",
        "hdimage/sound/playdata/63_a.bin",
        "hdimage/sound/playdata/63_c.bin",
        "hdimage/sound/playdata/64_1.bin",
        "hdimage/sound/playdata/64_a.bin",
        "hdimage/sound/playdata/64_c.bin",
        "hdimage/sound/playdata/65_1.bin",
        "hdimage/sound/playdata/65_a.bin",
        "hdimage/sound/playdata/65_c.bin",
        "hdimage/sound/playdata/66_1.bin",
        "hdimage/sound/playdata/66_a.bin",
        "hdimage/sound/playdata/66_c.bin",
        "hdimage/sound/playdata/sys_h.bin",
        "hdimage/sound/system/ppp2nd.bin",
        "hdimage/sound/system/ppp2nd.mb",
        "hdimage/sound/testmode/o4ao5a.adp",
        "sound/prog.zin",
    ]

    filename_hashes = {}
    for filename in found_filenames:
        filename_hashes[get_filename_hash(filename)] = filename

    # Parse file table
    with open(args.input, "rb") as infile:
        infile.seek(0x200)

        entries = []
        while True:
            filename_hash, file_offset, file_size, flags, checksum, decomp_size = struct.unpack(">IIIIII", infile.read(0x18))

            if filename_hash == 0:
                break

            file_offset *= 0x200

            entry = {
                'filename_hash': filename_hash,
                'offset': file_offset,
                'size': file_size,
                'decomp_size': decomp_size,
                'flags': flags,
                'checksum': checksum,
            }

            entries.append(entry)

        for entry in entries:
            print("%08x %08x %08x %08x %08x %08x" % (entry['filename_hash'], entry['offset'], entry['size'], entry['decomp_size'], entry['flags'], entry['checksum']), filename_hashes.get(entry['filename_hash'], ""))
            infile.seek(entry['offset'])

            if entry['filename_hash'] in filename_hashes:
                output_filename = filename_hashes[entry['filename_hash']]

            else:
                output_filename = "%08x.bin" % entry['filename_hash']

            output_filename = os.path.join(args.output, output_filename)

            if os.path.exists(output_filename):
                continue

            basedir = os.path.dirname(output_filename)
            if basedir and not os.path.exists(basedir):
                os.makedirs(basedir)

            with open(output_filename, "wb") as outfile:
                data = infile.read(entry['size'])

                is_zin = output_filename.endswith(".zin") or entry['filename_hash'] in [0x90547703]
                if is_zin:
                    # .zin files (and the bootloader) are supposed to be checksummed before decompression
                    checksum = sum(data) & 0xffffffff

                if entry['decomp_size'] != 0:
                    data = decompress_gcz(data)

                if not is_zin:
                    # Calculate checksum of extracted data
                    checksum = sum(data) & 0xffffffff

                outfile.write(data)

            if checksum != entry['checksum']:
                print("Invalid checksum for extracted data!")
